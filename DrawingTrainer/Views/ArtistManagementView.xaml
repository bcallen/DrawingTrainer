<UserControl x:Class="DrawingTrainer.Views.ArtistManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:DrawingTrainer.Converters">
    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVis"/>
        <converters:NullToVisibilityConverter x:Key="NullToVis"/>
    </UserControl.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" Text="Artists" Style="{StaticResource PageHeader}" Margin="0,0,0,20"/>

        <!-- Add Artist Form -->
        <Border Grid.Row="1" Style="{StaticResource Card}" Margin="0,0,0,16">
            <StackPanel>
                <TextBlock Text="Add Artist" FontWeight="SemiBold" FontSize="16" Margin="0,0,0,12"
                           Foreground="{StaticResource TextBrush}"/>
                <StackPanel Orientation="Horizontal">
                    <TextBox Text="{Binding NewArtistName, UpdateSourceTrigger=PropertyChanged}"
                             Width="300" FontSize="14" Padding="8,6" Margin="0,0,8,0"
                             VerticalContentAlignment="Center"/>
                    <Button Content="Add" Style="{StaticResource PrimaryButton}"
                            Command="{Binding AddArtistCommand}" Padding="16,6"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Artist List -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding Artists}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Style="{StaticResource Card}" Margin="0,0,0,8">
                            <Grid>
                                <!-- Normal display mode -->
                                <DockPanel>
                                    <DockPanel.Style>
                                        <Style TargetType="DockPanel">
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Style.Triggers>
                                                <DataTrigger Value="True">
                                                    <DataTrigger.Binding>
                                                        <MultiBinding>
                                                            <MultiBinding.Converter>
                                                                <converters:EqualityConverter/>
                                                            </MultiBinding.Converter>
                                                            <Binding Path="."/>
                                                            <Binding Path="DataContext.EditingArtist"
                                                                     RelativeSource="{RelativeSource AncestorType=UserControl}"/>
                                                        </MultiBinding>
                                                    </DataTrigger.Binding>
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DockPanel.Style>

                                    <TextBlock Text="{Binding Name}" FontSize="16" FontWeight="SemiBold"
                                               Foreground="{StaticResource TextBrush}" VerticalAlignment="Center"
                                               DockPanel.Dock="Left"/>
                                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Right"
                                                HorizontalAlignment="Right">
                                        <Button Content="Edit" Style="{StaticResource SecondaryButton}"
                                                Padding="12,4" Margin="0,0,4,0"
                                                Command="{Binding DataContext.StartEditCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"/>
                                        <Button Content="Delete" Style="{StaticResource SecondaryButton}"
                                                Padding="12,4"
                                                Command="{Binding DataContext.DeleteArtistCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"/>
                                    </StackPanel>
                                </DockPanel>

                                <!-- Inline edit mode -->
                                <StackPanel Orientation="Horizontal">
                                    <StackPanel.Style>
                                        <Style TargetType="StackPanel">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Value="True">
                                                    <DataTrigger.Binding>
                                                        <MultiBinding>
                                                            <MultiBinding.Converter>
                                                                <converters:EqualityConverter/>
                                                            </MultiBinding.Converter>
                                                            <Binding Path="."/>
                                                            <Binding Path="DataContext.EditingArtist"
                                                                     RelativeSource="{RelativeSource AncestorType=UserControl}"/>
                                                        </MultiBinding>
                                                    </DataTrigger.Binding>
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </StackPanel.Style>

                                    <TextBox Text="{Binding DataContext.EditName, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}"
                                             Width="300" FontSize="14" Padding="8,6" Margin="0,0,8,0"
                                             VerticalContentAlignment="Center"/>
                                    <Button Content="Save" Style="{StaticResource PrimaryButton}"
                                            Padding="12,4" Margin="0,0,4,0"
                                            Command="{Binding DataContext.SaveEditCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                                    <Button Content="Cancel" Style="{StaticResource SecondaryButton}"
                                            Padding="12,4"
                                            Command="{Binding DataContext.CancelEditCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Empty State -->
        <TextBlock Grid.Row="2" Text="No artists yet. Add one above!"
                   FontSize="16" Foreground="{StaticResource TextLightBrush}"
                   HorizontalAlignment="Center" VerticalAlignment="Center">
            <TextBlock.Style>
                <Style TargetType="TextBlock">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding Artists.Count}" Value="0">
                            <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </TextBlock.Style>
        </TextBlock>
    </Grid>
</UserControl>
